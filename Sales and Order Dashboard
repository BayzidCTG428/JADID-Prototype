<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Slate 50 */
            min-height: 100vh;
            padding: 20px;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
        }
        .status-pill {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-Completed { background-color: #d1fae5; color: #059669; } /* Green */
        .status-Pending { background-color: #fef3c7; color: #d97706; } /* Yellow */
        .status-Processing { background-color: #bfdbfe; color: #3b82f6; } /* Blue */
        .status-Shipped { background-color: #c7d2fe; color: #6366f1; } /* Indigo */
        .status-Cancelled { background-color: #fee2e2; color: #ef4444; } /* Red */

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background: white;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 400px;
            padding: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
    </style>
</head>
<body>

    <div class="max-w-7xl mx-auto space-y-8">
        <header class="flex justify-between items-center py-4 border-b">
            <h1 class="text-3xl font-bold text-gray-900">Sales & Order Dashboard</h1>
            <div class="flex space-x-3">
                <button id="seed-btn" class="px-4 py-2 bg-pink-500 text-white font-semibold rounded-lg hover:bg-pink-600 transition duration-150 shadow-md text-sm">
                    Seed Sample Data
                </button>
                <span id="user-display" class="px-4 py-2 bg-gray-100 text-gray-700 font-medium rounded-lg text-sm truncate max-w-xs">Connecting...</span>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="flex border-b border-gray-200">
            <button id="tab-summary" onclick="changeView('summary')" class="px-6 py-2 text-lg font-medium border-b-2 border-indigo-500 text-indigo-600 focus:outline-none">Summary</button>
            <button id="tab-orders" onclick="changeView('orders')" class="px-6 py-2 text-lg font-medium text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300 focus:outline-none">Orders</button>
        </div>

        <!-- SUMMARY VIEW -->
        <div id="view-summary" class="space-y-6">
            <h2 class="text-2xl font-semibold text-gray-800">Financial Overview</h2>

            <div id="time-filter" class="space-x-4">
                <label for="year-select" class="font-medium text-gray-700">Filter by Year:</label>
                <select id="year-select" onchange="renderSummary()" class="p-2 border border-gray-300 rounded-lg">
                    <!-- Options populated by JS -->
                </select>
            </div>

            <div id="financial-summary-cards" class="grid lg:grid-cols-3 gap-6">
                <!-- Total Cost Price -->
                <div class="card bg-red-50">
                    <p class="text-lg font-medium text-red-600">Total Cost Price</p>
                    <p class="text-4xl font-extrabold text-red-800 mt-1" id="summary-cost">--</p>
                </div>
                <!-- Total Selling Price -->
                <div class="card bg-indigo-50">
                    <p class="text-lg font-medium text-indigo-600">Total Selling Price</p>
                    <p class="text-4xl font-extrabold text-indigo-800 mt-1" id="summary-selling">--</p>
                </div>
                <!-- Total Profit/Loss -->
                <div class="card bg-green-50">
                    <p class="text-lg font-medium text-green-600">Total Profit / Loss</p>
                    <p class="text-4xl font-extrabold text-green-800 mt-1" id="summary-profit">--</p>
                </div>
            </div>

            <!-- Monthly Breakdown Table -->
            <div class="card">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Monthly Breakdown</h3>
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Month</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Orders</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Cost (CP)</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Sales (SP)</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Profit</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="monthly-breakdown">
                        <tr id="breakdown-loading"><td colspan="5" class="py-4 text-center text-gray-500">Loading financial data...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ORDERS VIEW -->
        <div id="view-orders" class="hidden space-y-6">
            <h2 class="text-2xl font-semibold text-gray-800">All Orders</h2>
            <div class="card">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Order Date</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Client</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Action</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="orders-list">
                            <tr id="orders-loading"><td colspan="5" class="py-4 text-center text-gray-500">Fetching order list...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="no-orders" class="hidden py-4 text-center text-gray-500">No orders found. Use the "Seed Sample Data" button to get started.</div>
            </div>
        </div>
    </div>

    <!-- Status Update Modal -->
    <div id="status-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-semibold mb-4">Update Order Status</h3>
            <p class="mb-4 text-sm text-gray-600">Updating status for Order ID: <span id="modal-order-id" class="font-mono"></span></p>
            <select id="modal-status-select" class="w-full p-2 border border-gray-300 rounded-lg mb-4">
                <option value="Pending">Pending</option>
                <option value="Processing">Processing</option>
                <option value="Shipped">Shipped</option>
                <option value="Completed">Completed</option>
                <option value="Cancelled">Cancelled</option>
            </select>
            <div class="flex justify-end space-x-3">
                <button onclick="closeStatusModal()" class="px-4 py-2 text-gray-600 rounded-lg hover:bg-gray-100">Cancel</button>
                <button onclick="saveStatusUpdate()" id="modal-save-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50">Save</button>
            </div>
        </div>
    </div>

    <!-- Client Details Modal -->
    <div id="client-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-semibold mb-4 text-indigo-700">Client Details</h3>
            <div class="space-y-2">
                <p><span class="font-medium text-gray-600">Client Name:</span> <span id="client-name" class="font-semibold text-gray-800"></span></p>
                <p><span class="font-medium text-gray-600">Email:</span> <span id="client-email" class="text-gray-700"></span></p>
                <p><span class="font-medium text-gray-600">Total Orders:</span> <span id="client-total-orders" class="text-gray-700"></span></p>
                <p><span class="font-medium text-gray-600">Highest Order Value:</span> <span id="client-highest-order" class="text-gray-700"></span></p>
            </div>
            <div class="flex justify-end mt-6">
                <button onclick="closeClientModal()" class="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200">Close</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, onSnapshot, collection, query, serverTimestamp, setDoc, updateDoc, getDocs, where, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- GLOBAL VARIABLES (Provided by Canvas Environment) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app;
        let db;
        let auth;
        let userId = null;
        let isAuthReady = false;
        let allOrders = []; // Global store for all fetched orders
        let currentView = 'summary'; // State for managing tabs

        // Set Firebase logging level (Removed as it caused a SyntaxError during import)
        // setLogLevel('debug');

        // DOM Elements
        const viewSummaryEl = document.getElementById('view-summary');
        const viewOrdersEl = document.getElementById('view-orders');
        const tabSummaryEl = document.getElementById('tab-summary');
        const tabOrdersEl = document.getElementById('tab-orders');
        const ordersListEl = document.getElementById('orders-list');
        const yearSelectEl = document.getElementById('year-select');
        const breakdownEl = document.getElementById('monthly-breakdown');
        const statusModal = document.getElementById('status-modal');
        const clientModal = document.getElementById('client-modal');
        const userDisplayEl = document.getElementById('user-display');
        const noOrdersEl = document.getElementById('no-orders');
        const seedBtnEl = document.getElementById('seed-btn');

        let currentOrderId = null; // For status update modal

        // --- UTILS ---

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
        }

        function getStatusClass(status) {
            return `status-${status.replace(/\s/g, '')}`;
        }

        function getQuotesCollectionRef() {
            if (!userId) {
                throw new Error("User not authenticated.");
            }
            // Path: /artifacts/{appId}/users/{userId}/orders
            return collection(db, `artifacts/${appId}/users/${userId}/orders`);
        }

        function changeView(view) {
            currentView = view;
            viewSummaryEl.classList.add('hidden');
            viewOrdersEl.classList.add('hidden');
            tabSummaryEl.classList.remove('border-indigo-500', 'text-indigo-600');
            tabOrdersEl.classList.remove('border-indigo-500', 'text-indigo-600');
            tabSummaryEl.classList.add('text-gray-500', 'hover:border-gray-300');
            tabOrdersEl.classList.add('text-gray-500', 'hover:border-gray-300');

            if (view === 'summary') {
                viewSummaryEl.classList.remove('hidden');
                tabSummaryEl.classList.add('border-indigo-500', 'text-indigo-600');
                tabSummaryEl.classList.remove('text-gray-500', 'hover:border-gray-300');
                renderSummary(); // Re-render summary on view change
            } else if (view === 'orders') {
                viewOrdersEl.classList.remove('hidden');
                tabOrdersEl.classList.add('border-indigo-500', 'text-indigo-600');
                tabOrdersEl.classList.remove('text-gray-500', 'hover:border-gray-300');
                renderOrders(); // Re-render orders on view change
            }
        }

        // --- FIREBASE INITIALIZATION AND AUTHENTICATION ---
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
        } catch (e) {
            console.error("Firebase Initialization Error:", e);
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                userDisplayEl.textContent = `User ID: ${userId}`;
                isAuthReady = true;
                startDashboardListener();
            } else {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Auth Sign-in Error:", error);
                    userDisplayEl.textContent = "Auth Failed";
                }
            }
        });

        // --- DASHBOARD DATA ANALYSIS & RENDERING ---

        function analyzeData(orders) {
            const results = {
                totalOrders: orders.length,
                totalCost: 0,
                totalSelling: 0,
                totalProfit: 0,
                years: new Set(),
                monthlyData: new Map(), // Key: YYYY-MM
                clientDetails: new Map(), // Key: clientEmail
            };

            orders.forEach(order => {
                const date = order.orderDate.toDate();
                const year = date.getFullYear().toString();
                const month = date.getMonth();
                const key = `${year}-${String(month + 1).padStart(2, '0')}`;
                
                results.years.add(year);

                const cp = order.costPrice || 0;
                const sp = order.sellingPrice || 0;
                const profit = sp - cp;
                
                results.totalCost += cp;
                results.totalSelling += sp;
                results.totalProfit += profit;

                // Aggregate monthly data
                const monthEntry = results.monthlyData.get(key) || { 
                    month: date.toLocaleString('default', { month: 'long' }), 
                    year: year,
                    orders: 0, 
                    cost: 0, 
                    selling: 0, 
                    profit: 0 
                };
                monthEntry.orders += 1;
                monthEntry.cost += cp;
                monthEntry.selling += sp;
                monthEntry.profit += profit;
                results.monthlyData.set(key, monthEntry);

                // Aggregate client details
                const clientEmail = order.clientEmail;
                const clientEntry = results.clientDetails.get(clientEmail) || {
                    name: order.clientName,
                    email: clientEmail,
                    totalOrders: 0,
                    highestOrderValue: 0
                };
                clientEntry.totalOrders += 1;
                clientEntry.highestOrderValue = Math.max(clientEntry.highestOrderValue, sp);
                results.clientDetails.set(clientEmail, clientEntry);
            });

            // Convert map to sorted array for display
            results.monthlyDataArray = Array.from(results.monthlyData.values())
                .sort((a, b) => {
                    if (a.year !== b.year) return parseInt(b.year) - parseInt(a.year);
                    return new Date(`01 ${a.month} ${a.year}`).getTime() - new Date(`01 ${b.month} ${b.year}`).getTime();
                }).reverse();

            return results;
        }

        function populateYearFilter(years) {
            const currentYear = new Date().getFullYear().toString();
            yearSelectEl.innerHTML = '';
            
            // Add All option
            const allOption = document.createElement('option');
            allOption.value = 'All';
            allOption.textContent = 'All Years';
            yearSelectEl.appendChild(allOption);
            
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelectEl.appendChild(option);
            });

            // Ensure the selected year is always at least one of the years present if available
            if (years.size > 0 && !years.has(yearSelectEl.value)) {
                 yearSelectEl.value = 'All';
            }
        }

        window.renderSummary = function() {
            const selectedYear = yearSelectEl.value;
            let filteredOrders = allOrders;

            // Step 1: Filter Orders by Year
            if (selectedYear !== 'All') {
                filteredOrders = allOrders.filter(order => {
                    return order.orderDate.toDate().getFullYear().toString() === selectedYear;
                });
            }

            // Step 2: Analyze Filtered Data
            const metrics = analyzeData(filteredOrders);

            // Step 3: Update Summary Cards (Total for the filtered period)
            document.getElementById('summary-cost').textContent = formatCurrency(metrics.totalCost);
            document.getElementById('summary-selling').textContent = formatCurrency(metrics.totalSelling);
            
            const profitEl = document.getElementById('summary-profit');
            profitEl.textContent = formatCurrency(metrics.totalProfit);
            
            // Change color based on profit/loss
            profitEl.closest('.card').classList.remove('bg-green-50', 'bg-red-50');
            profitEl.closest('.card').classList.add(metrics.totalProfit >= 0 ? 'bg-green-50' : 'bg-red-50');
            profitEl.classList.remove('text-green-800', 'text-red-800');
            profitEl.classList.add(metrics.totalProfit >= 0 ? 'text-green-800' : 'text-red-800');


            // Step 4: Render Monthly Breakdown Table
            breakdownEl.innerHTML = '';
            if (metrics.monthlyDataArray.length === 0) {
                breakdownEl.innerHTML = `<tr><td colspan="5" class="py-4 text-center text-gray-500">No data for ${selectedYear === 'All' ? 'selected period' : selectedYear}.</td></tr>`;
                return;
            }

            metrics.monthlyDataArray.forEach(data => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-100';
                
                const profitColor = data.profit >= 0 ? 'text-green-600' : 'text-red-600';

                tr.innerHTML = `
                    <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${data.month} ${data.year}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">${data.orders}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">${formatCurrency(data.cost)}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">${formatCurrency(data.selling)}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm font-semibold ${profitColor}">${formatCurrency(data.profit)}</td>
                `;
                breakdownEl.appendChild(tr);
            });
        }

        // --- ORDER LIST RENDERING ---

        window.renderOrders = function() {
            ordersListEl.innerHTML = '';
            document.getElementById('orders-loading').classList.add('hidden');

            if (allOrders.length === 0) {
                noOrdersEl.classList.remove('hidden');
                return;
            } else {
                noOrdersEl.classList.add('hidden');
            }

            // Sort by latest order date
            const sortedOrders = [...allOrders].sort((a, b) => b.orderDate.toDate().getTime() - a.orderDate.toDate().getTime());

            const { clientDetails } = analyzeData(allOrders);

            sortedOrders.forEach(order => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-100';

                const orderDate = order.orderDate.toDate().toLocaleDateString();

                tr.innerHTML = `
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">${orderDate}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">
                        ${order.clientName}
                        <button onclick="openClientModal('${order.clientEmail}')" class="ml-2 text-indigo-500 hover:text-indigo-700 text-xs font-semibold">(View)</button>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap">
                        <span class="status-pill ${getStatusClass(order.status)}">${order.status}</span>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${formatCurrency(order.sellingPrice)}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm font-medium">
                        <button onclick="openStatusModal('${order.id}', '${order.status}')" class="text-xs px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition">Update Status</button>
                    </td>
                `;
                ordersListEl.appendChild(tr);
            });
        }

        // --- MODAL FUNCTIONS ---

        window.openStatusModal = function(orderId, currentStatus) {
            currentOrderId = orderId;
            document.getElementById('modal-order-id').textContent = orderId;
            document.getElementById('modal-status-select').value = currentStatus;
            statusModal.style.display = 'flex';
        }

        window.closeStatusModal = function() {
            statusModal.style.display = 'none';
            currentOrderId = null;
        }

        window.saveStatusUpdate = async function() {
            const newStatus = document.getElementById('modal-status-select').value;
            const saveBtn = document.getElementById('modal-save-btn');
            
            if (!currentOrderId || !newStatus) return;

            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';

            try {
                const orderRef = doc(getQuotesCollectionRef(), currentOrderId);
                await updateDoc(orderRef, { status: newStatus });
                console.log(`Order ${currentOrderId} status updated to ${newStatus}`);
                closeStatusModal();
            } catch (error) {
                console.error("Error updating order status:", error);
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save';
            }
        }

        window.openClientModal = function(clientEmail) {
            const { clientDetails } = analyzeData(allOrders);
            const client = clientDetails.get(clientEmail);

            if (client) {
                document.getElementById('client-name').textContent = client.name;
                document.getElementById('client-email').textContent = client.email;
                document.getElementById('client-total-orders').textContent = client.totalOrders;
                document.getElementById('client-highest-order').textContent = formatCurrency(client.highestOrderValue);
                clientModal.style.display = 'flex';
            }
        }

        window.closeClientModal = function() {
            clientModal.style.display = 'none';
        }

        // --- REAL-TIME DATA LISTENER ---

        function startDashboardListener() {
            if (!isAuthReady || !db) return;

            try {
                const q = query(getQuotesCollectionRef());
                
                onSnapshot(q, (snapshot) => {
                    const yearsSet = new Set();
                    allOrders = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        // Firestore Timestamp objects need to be converted to Date for analysis
                        if (data.orderDate && data.orderDate.toDate) {
                            allOrders.push({ id: doc.id, ...data });
                            yearsSet.add(data.orderDate.toDate().getFullYear().toString());
                        }
                    });

                    // Update UI components
                    populateYearFilter(yearsSet);
                    changeView(currentView); // Re-render the current view
                    
                    seedBtnEl.disabled = (allOrders.length > 0);
                    seedBtnEl.textContent = (allOrders.length > 0) ? 'Data Exists' : 'Seed Sample Data';

                }, (error) => {
                    console.error("Error listening to orders:", error);
                    document.getElementById('breakdown-loading').innerHTML = `<td colspan="5" class="py-4 text-center text-red-500">Error loading data: ${error.message}</td>`;
                });

            } catch (e) {
                console.error("Could not set up order listener:", e);
            }
        }

        // --- SEED DATA FUNCTION ---

        window.seedSampleData = async function() {
            if (!isAuthReady || allOrders.length > 0) return;

            seedBtnEl.disabled = true;
            seedBtnEl.textContent = 'Seeding...';

            const sampleOrders = [
                { clientName: "Alice Johnson", clientEmail: "alice@example.com", status: "Completed", costPrice: 150.00, sellingPrice: 250.00, orderDate: new Date('2025-09-15') },
                { clientName: "Bob Smith", clientEmail: "bob@sample.org", status: "Pending", costPrice: 500.00, sellingPrice: 900.00, orderDate: new Date('2025-10-01') },
                { clientName: "Alice Johnson", clientEmail: "alice@example.com", status: "Completed", costPrice: 200.00, sellingPrice: 450.00, orderDate: new Date('2025-10-10') },
                { clientName: "Charlie Brown", clientEmail: "charlie@corp.net", status: "Processing", costPrice: 75.00, sellingPrice: 100.00, orderDate: new Date('2025-10-25') },
                { clientName: "Bob Smith", clientEmail: "bob@sample.org", status: "Shipped", costPrice: 1200.00, sellingPrice: 1100.00, orderDate: new Date('2025-11-01') }, // Loss for demo
                { clientName: "Alice Johnson", clientEmail: "alice@example.com", status: "Completed", costPrice: 300.00, sellingPrice: 600.00, orderDate: new Date('2025-11-10') },
                { clientName: "Charlie Brown", clientEmail: "charlie@corp.net", status: "Pending", costPrice: 90.00, sellingPrice: 180.00, orderDate: new Date('2025-11-15') },
            ];

            const batch = [];
            sampleOrders.forEach(order => {
                // Use the correct Firestore Timestamp object for new documents
                const docRef = doc(getQuotesCollectionRef());
                const orderData = {
                    ...order,
                    orderDate: order.orderDate, 
                    userId: userId 
                };
                // NOTE: Using serverTimestamp() for a new field is often better in production, 
                // but since we rely on specific dates for the demo analytics, we'll keep the Date object.
                // When storing, Firestore automatically converts Date objects to Timestamps.
                batch.push(setDoc(docRef, orderData));
            });

            try {
                await Promise.all(batch);
                console.log("Sample data seeded successfully!");
            } catch (error) {
                console.error("Error seeding data:", error);
            } finally {
                seedBtnEl.disabled = false;
                seedBtnEl.textContent = 'Seed Sample Data';
            }
        }
        
        // Initialize the view on load
        document.addEventListener('DOMContentLoaded', () => {
            changeView('summary');
        });
    </script>
</body>
</html>
